<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Kanji Quiz</title>
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <style>
        * {
            font-size: 20px;
        }
        body {
            margin: 60px;
        }
        #reading {
            margin-top: 10px;
            font-size: 20px;
        }
        #word {
            font-weight: bold;
            font-size: 48px;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
<select id="level">
    <option value="N5" selected>N5</option>
    <option value="N4,N5">N4</option>
    <option value="N3,N4,N5">N3</option>
    <option value="N2,N3,N4,N5">N2</option>
    <option value="N1,N2,N3,N4,N5">N1</option>
</select>
<button onclick="next()">NEXT</button>
<div id="reading"></div>
<div id="word"></div>
<ol id="entries"></ol>
<div id="options"></div>

<script>

var edict = {}
var jouyou = {}
var pairs = {}
var subset = {}

const levelSelect = document.getElementById("level")
const wordText = document.getElementById("word")
const readingText = document.getElementById("reading")
const entryList = document.getElementById("entries")

async function load() {
    const res1 = await fetch("edict.json?1")
    edict = await res1.json()
    const res2 = await fetch("jouyou.json?1")
    jouyou = await res2.json()
    const res3 = await fetch("pairs.json?1")
    pairs = await res3.json()
    select()
    levelSelect.onchange = select
}

function select() {
    const levels = levelSelect.value.split(",")
    subset = {}
    levels.forEach((l) => Object.assign(subset, pairs[l]))
    next()
}

function next() {
    const randomIndex = Math.floor(Math.random() * subset.length)
    const word = subset[randomIndex]
    wordText.innerText = word
    const entry = edict[word][0]
    const reading = entry[0]
    readingText.innerText = reading
    entryList.innerHTML = ""
    entry.slice(1).forEach((term) => {
        const pos = term[0]
        const meanings = term[1]
        const li = document.createElement("li")
        li.innerText = "(" + pos + ") " +  meanings
        entryList.appendChild(li)
    })
}

load()

</script>

</body>

</html>