<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Kanji Finder</title>
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <link rel="icon" type="image/png" href="favicon.png">
    <style>
        * {
            font-size: 20px;
        }
        span {
            font-size: 22px;
        }
        input {
            margin-bottom: 10px;
        }
        button {
            font-size: 14px;
        }
        .selected {
            background-color: coral;
        }
    </style>
</head>

<body>
<div id="radical-list"></div>
<hr/>
<ul id="kanji-list"></ul>
<button id="more" onclick="filter(false)" hidden>More</button>
<hr/>
<input id="query" type="text"/><br>
<button onclick="delAll()">CLEAR</button> <button onclick="copy()">COPY</button> <button onclick="lookup()">LOOKUP</button> <button onclick="jisho()">JISHO</button>
<ul id="entry-list"></ul>

<script>

const RADICALS = {
    "ðŸ”„": "å†‚å‡µåŒšå›—åŽ‚å¹¿ç–’å°¸æˆ¸å¼‹æˆˆï©¦é–€è™",
    "â¬†ï¸": "äº å†–å®€ð †¢ç™¶âº¾ç½’âºŒç«¹é›¨",
    "â¬…ï¸": "å†«æ°µâº…å½³å¿„æ‰ŒçŠ­ç¤»è¡¤â»–æœ¨ç¦¾çŸ³ç³¸è¨€èˆŸè™«è¶³é£Ÿè»Šé‡‘é…‰é­šå¼“çˆ¿",
    "1ï¸âƒ£": "ä¸€ï½œä¸¶ãƒŽä¹™äº…",
    "2ï¸âƒ£": "äºŒäººå„¿ãƒå‡ åˆ€åˆ‚åŠ›å‹¹åŒ•ååœå©åŽ¶åˆãƒžä¹:å…¥ãƒ¦ä¹ƒ",
    "3ï¸âƒ£": "å£åœŸå£«å·¥å¹²å¤‚å¤•å¤§å¥³å­å¯¸å°å±±å·›å·²å·¾å¹ºå»¾ãƒ¨å½¡â»:å°¢å±®å·å½‘ä¹Ÿäº¡åŠä¹…å»´",
    "4ï¸âƒ£": "âº¹å¿ƒæ‰‹æ”µæ–¤æ–¹æ—¥æœˆæ¬ æ­¢æ­¹æ®³æ¯”æ°æ°´ç«ç¬çˆªç‰›çŠ¬çŽ‹å‹¿:æ”¯å…ƒäº•å¹¶æ–‡çˆ¶çˆ»æ— å°¤æ¯›å±¯äº”æ›°ç‰‡å·´æ¯‹æ–—æ°”",
    "5ï¸âƒ£": "ç”˜ç”¨ç”°ç–‹ç™½çš¿ç›®çŸ¢ç¤ºç¦¸ç©´ç«‹å†Š:ç”Ÿä¸–å·¨çŽ„æ¯çŸ›ç‰™çš®ç“¦",
    "6ï¸âƒ£": "ç±³ç¼¶ç¾Šç¾½è€³è¿è‡ªè‡³è‡¼è‰®è¡£è‡£è¥¿:è‰²èˆŒè¡€è¡Œç“œè‚‰è€’è€Œèˆ›",
    "7ï¸âƒ£": "è¦‹è±†è±•è²è¾›é‡†:è°·è±¸è§’èµ°èº«èµ¤è¾°é‚‘éº¦",
    "8ï¸âƒ£": "é‡Œé•·éš¹é©:é’å…æ–‰éžå¥„å²¡éš¶",
    "9ï¸âƒ£": "éŸ³é å“:é¢é¢¨é¦–éŸ­é¦™é£›",
    "ðŸ”Ÿ": "é¦¬:é¬¥é¬¼éª¨éŸ‹é¬²ç«œé«Ÿé¬¯é«˜",
    "*ï¸âƒ£": "é³¥:äº€é»’éº»é»„é¹¿é¹µæ­¯ç„¡é»é»¹é»½é¼ é¼“é¼Žé¼»é½Šæ»´é¾ ",
}

var krad = {}
var edict = {}

var components = []

let radicalList = document.getElementById("radical-list")
let kanjiList = document.getElementById("kanji-list")
let moreButton = document.getElementById("more")
let query = document.getElementById("query")
let entryList = document.getElementById("entry-list")

function init() {
    fetch("krad.json#2").then(r => r.json()).then(d => krad = d)
    fetch("edict.json#1").then(r => r.json()).then(d => edict = d)
    buildButtons()
}

function buildButtons() {
    radicalList.innerHTML = ""
    for (let subset in RADICALS) {
        const group = document.createElement("div")
        group.textContent = subset + " "
        let rare = false
        for (let radical of RADICALS[subset]) {
            if (radical == ":") {
                rare = true
                continue
            }
            const btn = document.createElement("span")
            btn.textContent = radical
            if (rare) btn.style.color = "grey"
            btn.onclick = () => {
                if (btn.classList.contains("selected")) {
                    components = components.filter(c => c != radical)
                    btn.classList.remove("selected")
                } else {
                    components.push(radical)
                    btn.classList.add("selected")
                }
                filter(true)
            }
            group.appendChild(btn)
        }
        radicalList.appendChild(group)
    }
}

function filter(jouyouOnly) {

    kanjiList.innerHTML = ""

    if (components.length == 0) return

    let html = ""
    for (let entry of krad) {
        if ((entry.length == 2) && jouyouOnly) continue
        const decomp = entry[1]
        let match = true
        for (let radical of components) {
            if (!decomp.includes(radical)) {
                match = false
                break
            }
        }
        if (!match) continue
        let kanji = entry[0]
        let meanings = entry[2] || ""
        html += "<li onclick=\"query.value += '" + kanji + "'\">" + kanji + 'ï¼ˆ' + decomp + 'ï¼‰' + meanings.toUpperCase() + "</li>"
    }

    kanjiList.innerHTML = html
    moreButton.hidden = !jouyouOnly
}

function copy() {

    navigator.clipboard.writeText(query.value);
}

function delAll() {

    query.value = ""
    lookup()
}

function lookup() {

    entryList.innerHTML = ""

    if (query.value.length == 0) return

    let html = ""
    Object.entries(edict).forEach(([key, value]) => {
        if (key.includes(query.value)) {
            const entry = "[" + value[0][0] + "] - " + value[0][1][1]
            html += "<li><b>" + key + "</b> " + entry + "</li>"
        }
    })

    if (html == "") entryList.innerHTML = "<li>no matches</li>"
    else entryList.innerHTML = html
}

function jisho() {

    open("https://jisho.org/search/" + query.value, "_blank")
}

init()

</script>

</body>

</html>