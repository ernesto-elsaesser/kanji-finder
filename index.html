<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Kanji Finder</title>
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <style>
        * {
            font-size: 20px;
        }
        #radical-list {
            font-size: 22px;
        }
        .rare {
            color: grey;
        }
        .selected {
            background-color: coral;
        }
        input {
            width: 100px;
        }
    </style>
</head>

<body>
<div id="radical-list"></div>
<hr/>
<ul id="kanji-list"></ul>
<hr/>
<input id="lookup-input" type="text"/> <button onclick="clearLookup()">X</button> <button onclick="lookup()">LOOKUP</button>
<ul id="lookup-results"></ul>

<script>

const RADICALS = {
    "ðŸ”„": "å†‚å‡µåŒšå›—åŽ‚å¹¿ç–’å°¸æˆ¸å¼‹æˆˆï©¦é–€è™",
    "â¬†ï¸": "äº å†–å®€ð †¢ç™¶âº¾ç½’âºŒç«¹é›¨",
    "â¬…ï¸": "å†«æ°µâº…å½³å¿„æ‰ŒçŠ­ç¤»è¡¤â»–æœ¨ç¦¾çŸ³ç³¸è¨€èˆŸè™«è¶³é£Ÿè»Šé‡‘é…‰é­šå¼“çˆ¿",
    "1ï¸âƒ£": "ä¸€ï½œä¸¶ãƒŽä¹™äº…",
    "2ï¸âƒ£": "äºŒäººå„¿ãƒå‡ åˆ€åˆ‚åŠ›å‹¹åŒ•ååœå©åŽ¶åˆãƒžä¹:å…¥ãƒ¦ä¹ƒ",
    "3ï¸âƒ£": "å£åœŸå£«å¤‚å¤•å¤§å¥³å­å¯¸å°å±±å·›å·¥å·²å·¾å¹²å¹ºå»¾ãƒ¨å½¡â»:å°¢å±®å·å½‘ä¹Ÿäº¡åŠä¹…å»´",
    "4ï¸âƒ£": "âº¹å¿ƒæ‰‹æ”µæ–¤æ–¹æ—¥æœˆæ¬ æ­¢æ­¹æ®³æ¯”æ°æ°´ç«ç¬çˆªç‰›çŠ¬çŽ‹å‹¿:æ”¯å…ƒäº•å¹¶æ–‡çˆ¶çˆ»æ— å°¤æ¯›å±¯äº”æ›°ç‰‡å·´æ¯‹æ–—æ°”",
    "5ï¸âƒ£": "ç”˜ç”¨ç”°ç–‹ç™½çš¿ç›®çŸ¢ç¤ºç¦¸ç©´ç«‹å†Š:ç”Ÿä¸–å·¨çŽ„æ¯çŸ›ç‰™çš®ç“¦",
    "6ï¸âƒ£": "ç±³ç¼¶ç¾Šç¾½è€³è¿è‡ªè‡³è‡¼è‰®è¡£è‡£è¥¿:è‰²èˆŒè¡€è¡Œç“œè‚‰è€’è€Œèˆ›",
    "7ï¸âƒ£": "è¦‹è±†è±•è²è¾›é‡†:è°·è±¸è§’èµ°èº«èµ¤è¾°é‚‘éº¦",
    "8ï¸âƒ£": "é‡Œé•·éš¹é©:é’å…æ–‰éžå¥„å²¡éš¶",
    "9ï¸âƒ£": "éŸ³é å“:é¢é¢¨é¦–éŸ­é¦™é£›",
    "ðŸ”Ÿ": "é¦¬:é¬¥é¬¼éª¨éŸ‹é¬²ç«œé«Ÿé¬¯é«˜",
    "*ï¸âƒ£": "é³¥:äº€é»’éº»é»„é¹¿é¹µæ­¯ç„¡é»é»¹é»½é¼ é¼“é¼Žé¼»é½Šæ»´é¾ ",
}

var edict = {}
var jouyou = {}

var components = []

let radicalList = document.getElementById("radical-list")
let kanjiList = document.getElementById("kanji-list")
let lookupInput = document.getElementById("lookup-input")
let lookupResults = document.getElementById("lookup-results")

function init() {
    fetch("edict.json#1").then(r => r.json()).then(d => edict = d)
    fetch("jouyou.json#1").then(r => r.json()).then(d => jouyou = d)
    buildButtons()
}

function buildButtons() {
    radicalList.innerHTML = ""
    for (let subset in RADICALS) {
        const group = document.createElement("div")
        group.textContent = subset + " "
        let rare = false
        for (let radical of RADICALS[subset]) {
            if (radical == ":") {
                rare = true
                continue
            }
            const btn = document.createElement("span")
            btn.textContent = radical
            if (rare) btn.classList = ["rare"]
            btn.onclick = () => {
                if (btn.classList.contains("selected")) {
                    components.pop()
                    btn.classList.remove("selected")
                } else {
                    components.push(radical)
                    btn.classList.add("selected")
                }
                filter()
            }
            group.appendChild(btn)
        }
        radicalList.appendChild(group)
    }
}

function filter() {

    kanjiList.innerHTML = ""

    if (components.length < 2) return

    let gotMatches = false
    for (let kanji in jouyou) {
        const info = jouyou[kanji]
        const decomp = info["decomp"]
        let match = true
        for (let radical of components) {
            if (!decomp.includes(radical)) {
                match = false
                break
            }
        }
        if (!match) continue
        const meanings = info["meanings"].toUpperCase()
        const readings = info["readings"].slice(0, 3).join("ã€")
        const item = document.createElement("li")
        item.textContent = kanji + ' (' + decomp + ') ãƒ» ' + meanings + ' ãƒ» ' + readings
        item.onclick = () => lookupInput.value += kanji
        kanjiList.appendChild(item)
        gotMatches = true
    }

    if (gotMatches) return

    const item = document.createElement("li")
    item.textContent = "no matches"
    kanjiList.appendChild(item)
}

function clearLookup() {

    lookupInput.value = ""
    lookupResults.innerHTML = ""
}

function lookup() {
    const query = lookupInput.value
    let html = ""
    Object.entries(edict).forEach(([key, value]) => {
        if (key.includes(query)) {
            const entry = "[" + value[0][0] + "] - " + value[0][1][1]
            html += "<li><b>" + key + "</b> " + entry + "</li>"
        }
    })

    if (html == "") lookupResults.innerHTML = "<li>no matches</li>"
    else lookupResults.innerHTML = html
}

init()

</script>

</body>

</html>