<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Kanji Finder</title>
    <meta content="width=device-width, initial-scale=1" name="viewport">
</head>

<body style="font-size: 20px">
<input id="lookup-input" type="text"/> <button onclick="clearLookup()">X</button> <button onclick="lookup()">DICTIONARY</button>
<ul id="lookup-results"></ul>

<input id="filter-input" type="text"/> <button onclick="clearFilter()">X</button> <button onclick="filter()">MULTI-RADICAL</button>
<ul id="filter-results"></ul>

<p id="radical-buttons"></p>
<script>

const radicals = {
    "roots": {
        "ğŸ”„": "å†‚å‡µåŒšå›—å‚å¹¿ç–’å°¸æˆ¸å¼‹æˆˆï©¦é–€è™",
        "â¬†ï¸": "äº å†–å®€ğ †¢ç™¶âº¾ç½’âºŒç«¹é›¨",
        "â¬…ï¸": "å†«æ°µâº…å½³å¿„æ‰ŒçŠ­ç¤»è¡¤â»–æœ¨ç¦¾çŸ³ç³¸è¨€èˆŸè™«è¶³é£Ÿè»Šé‡‘é…‰é­šå¼“çˆ¿",
    },
    "common": {
        "1ï¸âƒ£": "ä¸€ï½œä¸¶ãƒä¹™äº…",
        "2ï¸âƒ£": "äºŒäººå„¿ãƒå‡ åˆ€åˆ‚åŠ›å‹¹åŒ•ååœå©å¶åˆãƒä¹",
        "3ï¸âƒ£": "å£åœŸå£«å¤‚å¤•å¤§å¥³å­å¯¸å°å±±å·›å·¥å·²å·¾å¹²å¹ºå»¾ãƒ¨å½¡â»",
        "4ï¸âƒ£": "âº¹å¿ƒæ‰‹æ”µæ–¤æ–¹æ—¥æœˆæ¬ æ­¢æ­¹æ®³æ¯”æ°æ°´ç«ç¬çˆªç‰›çŠ¬ç‹å‹¿",
        "5ï¸âƒ£": "ç”˜ç”¨ç”°ç–‹ç™½çš¿ç›®çŸ¢ç¤ºç¦¸ç©´ç«‹ç¤»å†Š",
        "6ï¸âƒ£": "ç±³ç¼¶ç¾Šç¾½è€³è¿è‡ªè‡³è‡¼è‰®è¡£è‡£è¥¿",
        "7ï¸âƒ£": "è¦‹è±†è±•è²è¾›é‡†",
        "8ï¸âƒ£": "é‡Œé•·éš¹é©",
        "9ï¸âƒ£": "éŸ³é å“",
        "ğŸ”Ÿ": "é¦¬",
        "*ï¸âƒ£": "é³¥",
    },
    "rare": {
        "2ï¸âƒ£": "å…¥ãƒ¦ä¹ƒ",
        "3ï¸âƒ£": "å°¢å±®å·å½‘ä¹Ÿäº¡åŠä¹…å»´",
        "4ï¸âƒ£": "æ”¯å…ƒäº•å¹¶æ–‡çˆ¶çˆ»æ— å°¤æ¯›å±¯äº”æ›°ç‰‡å·´æ¯‹æ–—æ°”",
        "5ï¸âƒ£": "ç”Ÿä¸–å·¨ç„æ¯çŸ›ç‰™çš®ç“¦",
        "6ï¸âƒ£": "è‰²èˆŒè¡€è¡Œç“œè‚‰è€’è€Œèˆ›",
        "7ï¸âƒ£": "è°·è±¸è§’èµ°èº«èµ¤è¾°é‚‘éº¦",
        "8ï¸âƒ£": "é’å…æ–‰éå¥„å²¡éš¶",
        "9ï¸âƒ£": "é¢é¢¨é¦–éŸ­é¦™é£›",
        "ğŸ”Ÿ": "é¬¥é¬¼éª¨éŸ‹é¬²ç«œé«Ÿé¬¯é«˜",
        "*ï¸âƒ£": "äº€é»’éº»é»„é¹¿é¹µæ­¯ç„¡é»é»¹é»½é¼ é¼“é¼é¼»é½Šæ»´é¾ ",
    }
}

var edict = {}
var krad = {}

let lookupInput = document.getElementById("lookup-input")
let lookupResults = document.getElementById("lookup-results")
let filterInput = document.getElementById("filter-input")
let filterResults = document.getElementById("filter-results")
let radicalButtons = document.getElementById("radical-buttons")

function build() {
    let html = ""
    for (let group in radicals) {
        html += "<hr/>"
        for (let subset in radicals[group]) {
            html += subset + " "
            for (let radical of radicals[group][subset]) {
                html += '<span onclick="add(\'' + radical + '\')">' + radical + '</span>'
            }
            html += "<br/>"
        }
    }
    radicalButtons.innerHTML = html
}

function add(radical) {

    filterInput.value += radical
}

function clearFilter() {

    filterInput.value = ""
    filterResults.innerHTML = ""
}

function filter() {
    const components = Array.from(filterInput.value)

    let html = ""
    for (let kanji in krad) {
        const info = krad[kanji]
        const decomp = info["decomp"]
        let match = true
        for (let radical of components) {
            if (!decomp.includes(radical)) {
                match = false
                break
            }
        }
        if (!match) continue
        const meanings = info["meanings"].toUpperCase()
        const item = kanji + ' (' + decomp + ') ãƒ» ' + meanings + ' ãƒ» ' + info["on"] + " ãƒ» " + info["kun"] + " ãƒ» N" + info["jlpt"].toString()
        html += '<li onclick="select(\'' + kanji + '\')">' + item + '</li>'
    }

    if (html == "") filterResults.innerHTML = "<li>no matches</li>"
    else filterResults.innerHTML = html
}

function select(kanji) {

    lookupInput.value += kanji
}

function clearLookup() {

    lookupInput.value = ""
    lookupResults.innerHTML = ""
}

function lookup() {
    const query = lookupInput.value
    let html = ""
    Object.entries(edict).forEach((entry) => {
        if (entry[0].includes(query)) html += "<li><b>" + entry[0] + "</b> " + entry[1] + "</li>" 
    })

    if (html == "") lookupResults.innerHTML = "<li>no matches</li>"
    else lookupResults.innerHTML = html
}

build()

fetch("edict.json?v=2").then((res) => res.json()).then((data) => {
    edict = data
})

fetch("krad.json?v=2").then((res) => res.json()).then((data) => {
    krad = data
})

</script>

</body>

</html>